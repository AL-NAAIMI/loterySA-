{% extends "layout.html" %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4 fw-bold border-bottom pb-3">Panneau d'Administration</h1>

    <div class="row g-4">
        <!-- Bloc 1 : DÃ©ploiement -->
        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white fw-bold py-3">ğŸš€ DÃ©ploiement</div>
                <div class="card-body">
                    <p class="card-text text-muted">DÃ©ployez une nouvelle instance du contrat de loterie sur la
                        blockchain.</p>
                    <form action="{{ url_for('admin_deploy') }}" method="POST" onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir dÃ©ployer un nouveau contrat ?');">
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">DÃ©ployer un nouveau contrat</button>
                        </div>
                    </form>
                    {% if contract_address %}
                    <div class="alert alert-info mt-3 mb-0 small">
                        <strong>Actif :</strong> {{ contract_address }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Bloc 2 : Tirage -->
        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white fw-bold py-3">ğŸ² Tirage au sort</div>
                <div class="card-body">
                    <p class="card-text text-muted">Lancez le tirage pour dÃ©signer le gagnant parmi les participants.
                    </p>
                    <form action="{{ url_for('admin_tirage') }}" method="POST" onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir lancer le tirage ? Cette action est irrÃ©versible.');">
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success" {% if not contract_address %}disabled{% endif
                                %}>
                                Lancer le tirage
                            </button>
                        </div>
                    </form>
                    <p class="mt-3 small text-muted fst-italic">
                        Note : NÃ©cessite au moins 3 participants.
                    </p>
                </div>
            </div>
        </div>

        <!-- Bloc 3 : Ã‰tat -->
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-light">
                <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
                    <div>
                        <h5 class="card-title mb-1">{% if is_terminated %}Contrat terminÃ©{% else %}Ã‰tat du contrat actif{% endif %}</h5>
                        <p class="mb-0 text-muted font-monospace">{{ contract_address if contract_address else 'Aucun
                            contrat' }}</p>
                    </div>
                    <div class="text-end mt-3 mt-md-0">
                        <div class="display-6 fw-bold text-primary">{{ solde }} ETH</div>
                        <a href="{{ url_for('cagnotte') }}" class="text-decoration-none small">Voir la page cagnotte
                            &rarr;</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bloc 4 : Dernier Gagnant -->
        {% if winner_info and winner_info.winner %}
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-success text-white">
                <div class="card-header bg-transparent border-0 fw-bold py-3">
                    ğŸ† Dernier Gagnant
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="mb-2">Adresse du Gagnant</h5>
                            <p class="font-monospace mb-0 fs-6">{{ winner_info.winner }}</p>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <div class="mb-2">
                                <small class="opacity-75">Gain du gagnant (90%)</small>
                                <div class="fs-4 fw-bold">{{ "%.4f"|format(winner_info.prize) }} ETH</div>
                            </div>
                            <div>
                                <small class="opacity-75">Frais association (10%)</small>
                                <div class="fs-5">{{ "%.4f"|format(winner_info.owner_fee) }} ETH</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}